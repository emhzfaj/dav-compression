<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Background Remover</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .file-upload-label {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        #imageCanvas {
            background-image:
                linear-gradient(45deg, #ccc 25%, transparent 25%),
                linear-gradient(-45deg, #ccc 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #ccc 75%),
                linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            cursor: crosshair; /* Add crosshair cursor for color picking */
        }
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus {
            outline: none;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #4a5568;
            border-radius: 5px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
            margin-top: -6px;
        }
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #4a5568;
            border-radius: 5px;
        }
        input[type=range]::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
        }
        /* Custom style for the color picker */
        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 48px;
            height: 40px;
            padding: 0;
            border-radius: 8px;
            cursor: pointer;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: 1px solid #4a5568;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto p-6 md:p-8 bg-gray-800 rounded-2xl shadow-2xl text-center">
        <h1 class="text-3xl md:text-4xl font-bold mb-3">Background Remover</h1>
        <p class="text-gray-400 mb-6">Upload an image, then click on a color to remove it.</p>

        <!-- File Upload Area -->
        <div id="upload-container" class="mb-6">
            <label for="imageLoader" class="file-upload-label bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                Upload Image
            </label>
            <input type="file" id="imageLoader" name="imageLoader" class="hidden" accept="image/*"/>
        </div>

        <!-- Canvas for Image Processing -->
        <div id="canvas-container" class="w-full flex justify-center mb-6">
             <canvas id="imageCanvas" class="rounded-lg shadow-md max-w-full h-auto"></canvas>
        </div>
        
        <!-- Controls Area -->
        <div id="controls-container" class="hidden my-6 px-4">
            <div class="flex items-center justify-center space-x-4">
                <div>
                    <label for="colorPicker" class="block mb-2 text-sm font-medium text-gray-300">Target Color</label>
                    <input id="colorPicker" type="color" value="#ffffff">
                </div>
                <div class="w-full">
                    <label for="toleranceSlider" class="block mb-2 text-sm font-medium text-gray-300">Tolerance: <span id="toleranceValue" class="font-bold text-indigo-400">50</span></label>
                    <input id="toleranceSlider" type="range" min="0" max="255" value="50" class="w-full">
                </div>
            </div>
        </div>

        <!-- Download Button -->
        <div id="download-container" class="hidden">
            <button id="downloadBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 inline-flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                Download Result
            </button>
        </div>
         <p id="message" class="text-gray-500 mt-4"></p>
    </div>

    <script>
        // DOM Elements
        const imageLoader = document.getElementById('imageLoader');
        const canvas = document.getElementById('imageCanvas');
        const ctx = canvas.getContext('2d');
        const downloadBtn = document.getElementById('downloadBtn');
        const downloadContainer = document.getElementById('download-container');
        const controlsContainer = document.getElementById('controls-container');
        const toleranceSlider = document.getElementById('toleranceSlider');
        const toleranceValue = document.getElementById('toleranceValue');
        const colorPicker = document.getElementById('colorPicker');
        const message = document.getElementById('message');

        // State variables
        let originalFileName = '';
        let originalImageData = null;
        let targetColor = { r: 255, g: 255, b: 255 };

        // Event Listeners
        imageLoader.addEventListener('change', handleImageUpload);
        toleranceSlider.addEventListener('input', handleToleranceChange);
        colorPicker.addEventListener('input', handleColorChange);
        downloadBtn.addEventListener('click', handleDownload);
        canvas.addEventListener('click', handleCanvasClick);

        /** Converts a hex color string to an RGB object. */
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        /** Converts an RGB object to a hex color string. */
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        /** Handles the initial image file upload. */
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) {
                message.textContent = 'No file selected.';
                return;
            }
            message.textContent = 'Processing image...';
            downloadContainer.classList.add('hidden');
            controlsContainer.classList.add('hidden');
            originalFileName = file.name.split('.').slice(0, -1).join('.');
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    processImage();
                    controlsContainer.classList.remove('hidden');
                    downloadContainer.classList.remove('hidden');
                    message.textContent = 'Processing complete. Click on the image to pick a color.';
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        }

        /** Re-processes the image when the tolerance slider is changed. */
        function handleToleranceChange() {
            toleranceValue.textContent = toleranceSlider.value;
            if (originalImageData) {
                processImage();
            }
        }

        /** Re-processes the image when the color picker value changes. */
        function handleColorChange() {
            targetColor = hexToRgb(colorPicker.value);
            if (originalImageData) {
                processImage();
            }
        }
        
        /** Handles clicking on the canvas to pick a color. */
        function handleCanvasClick(e) {
            if (!originalImageData) return;
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor(e.clientX - rect.left);
            const y = Math.floor(e.clientY - rect.top);
            const pixel = ctx.getImageData(x, y, 1, 1).data;
            
            targetColor = { r: pixel[0], g: pixel[1], b: pixel[2] };
            colorPicker.value = rgbToHex(pixel[0], pixel[1], pixel[2]);
            processImage();
        }

        /** Core image processing function. */
        function processImage() {
            if (!originalImageData) return;

            const imageData = new ImageData(new Uint8ClampedArray(originalImageData.data), originalImageData.width, originalImageData.height);
            const data = imageData.data;
            const tolerance = parseInt(toleranceSlider.value, 10);
            const { r: tr, g: tg, b: tb } = targetColor;

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Calculate the color distance using Euclidean distance formula
                const distance = Math.sqrt(Math.pow(r - tr, 2) + Math.pow(g - tg, 2) + Math.pow(b - tb, 2));

                if (distance < tolerance) {
                    // Make the pixel transparent
                    data[i + 3] = 0;
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        /** Handles the download button click. */
        function handleDownload() {
            const link = document.createElement('a');
            link.download = `${originalFileName}_transparent.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>
</html>
