<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Rack Panel â€¢ Brutal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <!-- jsQR for QR/barcode (QR) decoding -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <!-- QuaggaJS (1D barcode: Code128/EAN-13) optional -->
  <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
  <style>
    :root{
      --bg:#fafafa;          /* light background keeps brutalist contrast */
      --ink:#111;            /* strong black */
      --accent:#00E5A0;      /* neon mint */
      --accent2:#FFD400;     /* punchy yellow */
      --danger:#ff3b3b;
      --muted:#666;
      --card:#fff;
      --grid-gap:14px;
      --br:18px;             /* big rounded corners are allowed in new brutalism */
      --bw:3px;              /* thick border */
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:"Space Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      letter-spacing:0.2px;
    }
    /* Global layout */
    .wrap{max-width:1180px; margin:0 auto; padding:24px;}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      border:var(--bw) solid var(--ink); padding:12px 16px; border-radius:var(--br);
      background:linear-gradient(180deg,#fff, #f1f1f1);
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-family:"Archivo Black", system-ui; letter-spacing:0.5px; font-size:20px;
    }
    .brand .dot{width:14px;height:14px;border-radius:4px;background:var(--accent);border:var(--bw) solid var(--ink); box-shadow:3px 3px 0 #000;
    }
    .toolbar{display:flex; gap:10px; align-items:center}
    .btn{
      border:var(--bw) solid var(--ink); background:#fff; padding:10px 14px; border-radius:10px;
      font-weight:700; text-transform:uppercase; box-shadow:4px 4px 0 #000; cursor:pointer;
      transition:transform .05s ease;
    }
    .btn:active{ transform:translate(2px,2px); box-shadow:2px 2px 0 #000; }
    .btn.mint{ background:var(--accent); }
    .btn.yellow{ background:var(--accent2); }
    .btn.ghost{ background:transparent }
    .pill{ border:var(--bw) solid var(--ink); border-radius:999px; padding:6px 12px; display:inline-flex; gap:8px; align-items:center; font-weight:700 }

    .grid{ display:grid; grid-template-columns:repeat(12,1fr); gap:var(--grid-gap); margin-top:var(--grid-gap)}
    .card{ grid-column:span 12; border:var(--bw) solid var(--ink); background:var(--card); border-radius:var(--br); padding:16px; box-shadow:8px 8px 0 #000; }
    @media (min-width:720px){ .card.h6{ grid-column:span 6 } .card.h4{ grid-column:span 4 } }

    .section-title{ font-family:"Archivo Black"; font-size:22px; margin:0 0 8px 0 }
    .muted{ color:var(--muted) }
    .hr{ height:0; border:none; border-top:var(--bw) dashed var(--ink); margin:12px 0 }

    /* Login */
    #loginView{ display:grid; place-items:center; min-height:80svh }
    .login{
      width:min(560px,100%); background:#fff; border:var(--bw) solid var(--ink); border-radius:var(--br);
      padding:22px; box-shadow:12px 12px 0 #000;
    }
    .login h1{ font-family:"Archivo Black"; margin:0 0 4px 0 }
    .login .hint{ font-size:12px; color:#444 }
    .field{ display:flex; flex-direction:column; gap:6px; margin-top:12px }
    .field input{ border:var(--bw) solid var(--ink); border-radius:12px; padding:12px; font-size:16px; }
    .login .row{ display:flex; gap:12px; align-items:center; margin-top:12px; }
    .tag{ font-size:12px; background:#000; color:#fff; padding:4px 8px; border-radius:999px; }

    /* App */
    #appView{ display:none }
    .filters{ display:flex; flex-wrap:wrap; gap:8px; }
    .filters .btn{ padding:8px 10px }

    .rack-list{ display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:var(--grid-gap); }
    .rack{
      border:var(--bw) solid var(--ink); border-radius:14px; background:#fff; padding:12px; box-shadow:6px 6px 0 #000; position:relative;
    }
    .rack h3{ margin:0; font-size:18px; font-family:"Archivo Black" }
    .rack .meta{ font-size:12px; color:#333; margin-top:6px; }
    .rack .labels{ display:flex; flex-wrap:wrap; gap:6px; margin-top:10px }
    .badge{ border:var(--bw) solid var(--ink); border-radius:999px; padding:4px 8px; font-size:12px; background:var(--accent); }

    /* Drawer / Detail */
    .drawer{ position:fixed; inset:auto 0 0 0; background:#fff; border-top:var(--bw) solid var(--ink); box-shadow:0 -10px 0 #000; border-radius:18px 18px 0 0; display:none }
    .drawer .inner{ max-width:980px; margin:0 auto; padding:18px }
    .drawer .row{ display:grid; grid-template-columns:1fr 1fr; gap:var(--grid-gap) }
    .kv{ display:grid; grid-template-columns:160px 1fr; gap:8px; font-size:14px }
    .kv b{ font-family:"Archivo Black" }

    /* Scanner */
    .scanner{ display:grid; grid-template-columns:1fr; gap:12px; }
    .scanner video, .scanner canvas{ width:100%; border:var(--bw) solid var(--ink); border-radius:12px; }
    .scan-status{ font-weight:700 }

    /* Toaster */
    .toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:18px; background:#000; color:#fff; padding:10px 14px; border-radius:999px; display:none }

    /* Brutalist Decorations */
    .sticker{ position:fixed; right:12px; top:12px; rotate:-6deg; background:var(--accent2); border:var(--bw) solid var(--ink); padding:6px 10px; font-weight:700; box-shadow:6px 6px 0 #000; border-radius:8px }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="dot"></div>
        <div>RACK â€¢ PANEL â€¢ INDEX</div>
      </div>
      <div class="toolbar">
        <span id="loginBadge" class="pill" style="display:none">ðŸ”’ <span id="who"></span></span>
        <button class="btn ghost" id="scanBtn" style="display:none">ðŸ“· Scan</button>
        <button class="btn mint" id="logoutBtn" style="display:none">Logout</button>
      </div>
    </header>

    <!-- LOGIN VIEW -->
    <section id="loginView">
      <div class="login">
        <h1>Login untuk Akses</h1>
        <div class="hint">Scan barcode untuk <b>auto-login</b> atau masukkan kredensial manual.</div>
        <div class="row">
          <button class="btn yellow" id="openScannerLogin">ðŸ“· Scan Barcode</button>
          <span class="tag">Mode: QR / Code128</span>
        </div>
        <div class="scanner" id="loginScanner" style="display:none; margin-top:12px">
          <video id="videoLogin" playsinline></video>
          <canvas id="canvasLogin" hidden></canvas>
          <div class="scan-status" id="statusLogin">Camera initâ€¦</div>
        </div>
        <div class="hr"></div>
        <div class="field"><label>Username</label><input id="user" autocomplete="username" /></div>
        <div class="field"><label>Password</label><input id="pass" type="password" autocomplete="current-password"/></div>
        <div class="row">
          <button class="btn mint" id="doLogin">Masuk</button>
          <span class="muted">Demo: <code>admin / admin123</code></span>
        </div>
      </div>
    </section>

    <!-- APP VIEW -->
    <section id="appView">
      <div class="grid">
        <div class="card h6">
          <h2 class="section-title">Lokasi & Filter</h2>
          <div class="filters" id="filters"></div>
        </div>
        <div class="card h6">
          <h2 class="section-title">Pencarian</h2>
          <input id="search" placeholder="Cari: nama rack, VLAN, IP, catatanâ€¦" class="field-input" style="width:100%; padding:12px; border:var(--bw) solid var(--ink); border-radius:12px" />
        </div>
        <div class="card">
          <h2 class="section-title">Daftar Rack Panel</h2>
          <div class="rack-list" id="rackList"></div>
        </div>
        <div class="card h4">
          <h2 class="section-title">Scan Barcode</h2>
          <div class="scanner">
            <video id="video" playsinline muted></video>
            <canvas id="canvas" hidden></canvas>
            <div class="row" style="display:flex; gap:8px; align-items:center">
              <button class="btn" id="startScan">Start Camera</button>
              <button class="btn" id="stopScan">Stop</button>
              <span class="scan-status" id="scanStatus">Idle</span>
            </div>
            <small class="muted">Tip: tempel QR/Code128 pada tiap rack berisi <code>RACK_ID</code> atau URL <code>?rack=ID</code>.</small>
          </div>
        </div>
        <div class="card h4">
          <h2 class="section-title">Quick Add (Local)</h2>
          <div class="field"><label>RACK_ID</label><input id="qa_id"></div>
          <div class="field"><label>Nama</label><input id="qa_name"></div>
          <div class="field"><label>Lantai/Lokasi</label><input id="qa_floor" placeholder="1,2,3,5,6,7,8,BOH,Villa"></div>
          <div class="field"><label>IP Range</label><input id="qa_ip" placeholder="192.168.x.x/24"></div>
          <div class="field"><label>VLAN</label><input id="qa_vlan" placeholder="1117; 133"></div>
          <div class="row">
            <button class="btn mint" id="qa_save">Tambah</button>
            <button class="btn" id="qa_reset">Reset</button>
            <span class="muted">Data tersimpan ke <b>localStorage</b> (demo)</span>
          </div>
        </div>
      </div>
    </section>

    <!-- DRAWER DETAIL -->
    <div class="drawer" id="drawer">
      <div class="inner">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px">
          <h3 class="section-title" id="d_title">Detail Rack</h3>
          <button class="btn" id="d_close">Tutup</button>
        </div>
        <div class="row" style="margin-top:10px">
          <div class="card" style="box-shadow:none">
            <div class="kv"><b>ID</b><span id="d_id">-</span></div>
            <div class="kv"><b>Lokasi</b><span id="d_loc">-</span></div>
            <div class="kv"><b>IP Range</b><span id="d_ip">-</span></div>
            <div class="kv"><b>VLAN</b><span id="d_vlan">-</span></div>
            <div class="kv"><b>ISP</b><span id="d_isp">-</span></div>
            <div class="kv"><b>Kontak</b><span id="d_pic">-</span></div>
          </div>
          <div class="card" style="box-shadow:none">
            <div class="kv"><b>Switch</b><span id="d_switch">-</span></div>
            <div class="kv"><b>Port Uplink</b><span id="d_uplink">-</span></div>
            <div class="kv"><b>Catatan</b><span id="d_note">-</span></div>
            <div class="row" style="display:flex; gap:8px; margin-top:6px">
              <button class="btn yellow" id="d_copy">Copy Link</button>
              <button class="btn" id="d_edit">Edit (Local)</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="toast" id="toast"></div>
    <div class="sticker">BRUTAL BUILD â€¢ v0.1</div>
  </div>

<script>
/********************
 * Demo Auth (Front)
 ********************/
const AUTH_KEY = 'rack.auth.user';
const DEMO_USER = {u:'admin', p:'admin123', name:'Administrator'};

function saveAuth(u){ localStorage.setItem(AUTH_KEY, JSON.stringify(u)); }
function loadAuth(){ try{ return JSON.parse(localStorage.getItem(AUTH_KEY)||'null') }catch{ return null }
}
function clearAuth(){ localStorage.removeItem(AUTH_KEY) }

/********************
 * Demo Data Store
 ********************/
const STORE_KEY = 'rack.data';
const defaultRacks = [
  {id:'R1-L1', name:'Rack Lantai 1 - Core', floor:'1', ip:'192.168.10.0/24', vlan:'1117;133', isp:'ICONNET', pic:'IT A', sw:'Aruba CX 6300M', uplink:'SFP+10G ke Core', note:'IGMP Querier VLAN133 aktif'},
  {id:'R2-L2', name:'Rack Lantai 2', floor:'2', ip:'192.168.20.0/24', vlan:'20;1117', isp:'LINTASMAYA', pic:'IT B', sw:'Aruba 6000', uplink:'SFP ke Core', note:'Printer VLAN20'},
  {id:'R3-L3', name:'Rack Lantai 3', floor:'3', ip:'192.168.30.0/24', vlan:'1117', isp:'ICONNET', pic:'IT C', sw:'Aruba 6000', uplink:'1G Uplink', note:'WiFi & Office'},
  {id:'R5-L5', name:'Rack Lantai 5', floor:'5', ip:'192.168.50.0/24', vlan:'1117;133', isp:'ICONNET', pic:'NOC', sw:'MikroTik CRS326', uplink:'10G SFP+', note:'IPTV VLAN133'},
  {id:'R6-L6', name:'Rack Lantai 6', floor:'6', ip:'192.168.60.0/24', vlan:'1117', isp:'â€”', pic:'â€”', sw:'Aruba 6000', uplink:'1G', note:''},
  {id:'R7-L7', name:'Rack Lantai 7', floor:'7', ip:'192.168.70.0/24', vlan:'1117', isp:'â€”', pic:'â€”', sw:'Aruba 6000', uplink:'1G', note:''},
  {id:'R8-L8', name:'Rack Lantai 8', floor:'8', ip:'192.168.80.0/24', vlan:'1117', isp:'â€”', pic:'â€”', sw:'Aruba 6000', uplink:'1G', note:''},
  {id:'R-BOH', name:'Rack BOH',   floor:'BOH', ip:'10.10.10.0/24', vlan:'500', isp:'â€”', pic:'â€”', sw:'Aruba 6000', uplink:'1G', note:'Back of House'},
  {id:'R-VIL', name:'Rack Villa', floor:'Villa', ip:'172.16.10.0/24', vlan:'600', isp:'â€”', pic:'â€”', sw:'Aruba 6000', uplink:'1G', note:''},
];

function loadData(){
  try{
    const x = JSON.parse(localStorage.getItem(STORE_KEY)||'null');
    return Array.isArray(x) ? x : defaultRacks.slice();
  }catch{ return defaultRacks.slice() }
}
function saveData(arr){ localStorage.setItem(STORE_KEY, JSON.stringify(arr)) }

/********************
 * UI Helpers
 ********************/
const $ = sel => document.querySelector(sel);
function toast(msg, ms=1600){ const t=$('#toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none', ms); }
function show(id, on=true){ const el=$(id); if(!el) return; el.style.display = on? '' : 'none'; }

/********************
 * Login Flow
 ********************/
const loginView = $('#loginView');
const appView   = $('#appView');
const loginBadge= $('#loginBadge');
const who       = $('#who');
const logoutBtn = $('#logoutBtn');
const scanBtn   = $('#scanBtn');

function enterApp(user){
  saveAuth(user);
  who.textContent = user.name || user.u;
  show('#loginView', false);
  show('#appView', true);
  show('#loginBadge', true);
  show('#logoutBtn', true);
  show('#scanBtn', true);
  show('.sticker', false);
  renderFilters();
  renderRacks();
  applyQueryOpen();
}

function exitApp(){
  clearAuth();
  stopCamera();
  show('#appView', false);
  show('#loginView', true);
  show('#loginBadge', false);
  show('#logoutBtn', false);
  show('#scanBtn', false);
  show('.sticker', true);
}

$('#doLogin').addEventListener('click', ()=>{
  const u = $('#user').value.trim();
  const p = $('#pass').value.trim();
  if(u===DEMO_USER.u && p===DEMO_USER.p){ enterApp({u, name:'Administrator'}) }
  else toast('Username / Password salah', 1400);
});

logoutBtn.addEventListener('click', exitApp);

/********************
 * Filters, Search, List
 ********************/
let DATA = loadData();
let filterFloor = 'ALL';

const FLOORS = ['ALL','1','2','3','5','6','7','8','BOH','Villa'];

function renderFilters(){
  const box = $('#filters');
  box.innerHTML = '';
  FLOORS.forEach(f=>{
    const b = document.createElement('button');
    b.className = 'btn' + (filterFloor===f ? ' mint' : '');
    b.textContent = f;
    b.addEventListener('click', ()=>{ filterFloor=f; renderFilters(); renderRacks(); });
    box.appendChild(b);
  })
}

$('#search').addEventListener('input', ()=>renderRacks());

function renderRacks(){
  const q = $('#search').value.toLowerCase();
  const list = $('#rackList');
  list.innerHTML = '';
  DATA.filter(r => filterFloor==='ALL' || r.floor===filterFloor)
      .filter(r => !q || JSON.stringify(r).toLowerCase().includes(q))
      .forEach(r=>{
        const el = document.createElement('div');
        el.className='rack';
        el.innerHTML = `
          <h3>${r.name}</h3>
          <div class="meta">ID: <b>${r.id}</b> â€¢ Lokasi: <b>${r.floor}</b></div>
          <div class="labels">
            <span class="badge">IP ${r.ip||'-'}</span>
            <span class="badge">VLAN ${r.vlan||'-'}</span>
            <span class="badge">SW ${r.sw||'-'}</span>
          </div>
          <div class="row" style="margin-top:10px; display:flex; gap:8px">
            <button class="btn" data-id="${r.id}">Detail</button>
            <a class="btn yellow" href="?rack=${encodeURIComponent(r.id)}">Link</a>
          </div>
        `;
        el.querySelector('button').addEventListener('click', ()=>openDrawer(r.id));
        list.appendChild(el);
      });
}

/********************
 * Drawer (Detail)
 ********************/
const dEl = {
  wrap: $('#drawer'),
  title: $('#d_title'), id: $('#d_id'), loc: $('#d_loc'), ip: $('#d_ip'), vlan: $('#d_vlan'),
  isp: $('#d_isp'), pic: $('#d_pic'), sw: $('#d_switch'), up: $('#d_uplink'), note: $('#d_note')
};

function openDrawer(id){
  const r = DATA.find(x=>x.id===id); if(!r) return toast('Rack tidak ditemukan');
  dEl.title.textContent = r.name; dEl.id.textContent = r.id; dEl.loc.textContent=r.floor;
  dEl.ip.textContent=r.ip||'-'; dEl.vlan.textContent=r.vlan||'-'; dEl.isp.textContent=r.isp||'-';
  dEl.pic.textContent=r.pic||'-'; dEl.sw.textContent=r.sw||'-'; dEl.up.textContent=r.uplink||'-'; dEl.note.textContent=r.note||'-';
  dEl.wrap.style.display='block';
}
$('#d_close').addEventListener('click', ()=> dEl.wrap.style.display='none');
$('#d_copy').addEventListener('click', ()=>{
  const id = dEl.id.textContent; const url = location.origin + location.pathname + '?rack=' + encodeURIComponent(id);
  navigator.clipboard.writeText(url); toast('Link disalin');
});
$('#d_edit').addEventListener('click', ()=>{
  const id = dEl.id.textContent; const idx = DATA.findIndex(x=>x.id===id); if(idx<0) return;
  const r = DATA[idx];
  const ip = prompt('IP Range', r.ip||''); if(ip===null) return; r.ip = ip;
  const vlan = prompt('VLAN (pisah ;)', r.vlan||''); if(vlan===null) return; r.vlan = vlan;
  const note = prompt('Catatan', r.note||''); if(note===null) return; r.note = note;
  DATA[idx]=r; saveData(DATA); renderRacks(); openDrawer(id); toast('Perubahan disimpan');
});

function applyQueryOpen(){
  const params = new URLSearchParams(location.search);
  const id = params.get('rack'); if(!id) return;
  const r = DATA.find(x=>x.id===id);
  if(r) openDrawer(id); else toast('RACK_ID tidak dikenal');
}

/********************
 * Quick Add (demo)
 ********************/
$('#qa_save').addEventListener('click', ()=>{
  const id=$('#qa_id').value.trim(); if(!id) return toast('Isi RACK_ID');
  if(DATA.some(x=>x.id===id)) return toast('ID sudah ada');
  const obj={
    id,
    name: $('#qa_name').value.trim()||id,
    floor: $('#qa_floor').value.trim()||'1',
    ip: $('#qa_ip').value.trim()||'',
    vlan: $('#qa_vlan').value.trim()||'',
    isp:'â€”', pic:'â€”', sw:'â€”', uplink:'â€”', note:''
  };
  DATA.push(obj); saveData(DATA); renderRacks(); toast('Rack ditambahkan');
});
$('#qa_reset').addEventListener('click', ()=>{ localStorage.removeItem(STORE_KEY); DATA=loadData(); renderRacks(); toast('Reset ke default') });

/********************
 * Scanner (App) â€“ jsQR for QR; Quagga for Code128/EAN
 ********************/
let stream=null, scanTimer=null;
const video = $('#video');
const canvas= $('#canvas');
const ctx = canvas.getContext('2d');

async function startCamera(targetVideo){
  try{
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio:false });
    targetVideo.srcObject = stream; await targetVideo.play();
    $('#scanStatus').textContent='Camera ON';
  }catch(err){ console.error(err); toast('Tidak bisa akses kamera'); }
}
function stopCamera(){
  if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
  [video, $('#videoLogin')].forEach(v=>{ try{ v.pause(); v.srcObject=null }catch{} });
  if(scanTimer){ clearInterval(scanTimer); scanTimer=null; }
  try{ Quagga.stop(); }catch{}
  $('#scanStatus').textContent='Idle';
}

$('#startScan').addEventListener('click', ()=>{
  startCamera(video).then(()=> startLoopQR(video, canvas, ctx, code => handleCode(code)) );
});
$('#stopScan').addEventListener('click', stopCamera);
$('#scanBtn').addEventListener('click', ()=>{
  document.querySelector('#appView').scrollIntoView({behavior:'smooth'});
});

function startLoopQR(video, canvas, ctx, onCode){
  scanTimer && clearInterval(scanTimer);
  scanTimer = setInterval(()=>{
    if(!video.videoWidth) return;
    canvas.width = video.videoWidth; canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const img = ctx.getImageData(0,0,canvas.width,canvas.height);
    const code = jsQR(img.data, img.width, img.height);
    if(code && code.data){ onCode(code.data); }
  }, 250);

  // Start Quagga for 1D in parallel (optional)
  try{
    Quagga.init({
      inputStream: { name: 'Live', type: 'LiveStream', target: video.parentElement, constraints: { facingMode:'environment' } },
      decoder: { readers:['code_128_reader','ean_reader'] }, locate: true
    }, err => { if(err){ console.warn('Quagga init fail', err); return; } Quagga.start(); });
    Quagga.onDetected(res=>{
      if(res && res.codeResult && res.codeResult.code){ handleCode(res.codeResult.code); }
    });
  }catch(e){ console.warn('Quagga not available', e); }
}

function handleCode(data){
  // Accept two forms: raw RACK_ID or full URL with ?rack=ID
  let id=null;
  try{
    if(/^https?:\/\//i.test(data)){
      const u = new URL(data); id = u.searchParams.get('rack') || u.hash.replace('#','') || null;
    } else { id = data; }
  }catch{ id = data }
  if(!id) return;
  const r = DATA.find(x=>x.id===id);
  if(r){ openDrawer(id); toast('QR cocok: ' + id); }
  else toast('Kode tidak dikenal: '+data);
}

/********************
 * Scanner (Login)
 ********************/
const videoLogin = $('#videoLogin');
const canvasLogin= $('#canvasLogin');
const ctxLogin   = canvasLogin.getContext('2d');

$('#openScannerLogin').addEventListener('click', async ()=>{
  show('#loginScanner', true);
  await startCamera(videoLogin);
  $('#statusLogin').textContent='Scanningâ€¦ arahkan ke barcode login';
  scanTimer && clearInterval(scanTimer);
  scanTimer = setInterval(()=>{
    if(!videoLogin.videoWidth) return;
    canvasLogin.width = videoLogin.videoWidth; canvasLogin.height = videoLogin.videoHeight;
    ctxLogin.drawImage(videoLogin,0,0,canvasLogin.width,canvasLogin.height);
    const img = ctxLogin.getImageData(0,0,canvasLogin.width,canvasLogin.height);
    const code = jsQR(img.data, img.width, img.height);
    if(code && code.data){
      // Expect payload like: racklogin://u=admin&p=admin123
      const s = String(code.data);
      if(s.startsWith('racklogin://')){
        const params = new URLSearchParams(s.replace('racklogin://',''));
        const u = params.get('u'); const p = params.get('p');
        if(u===DEMO_USER.u && p===DEMO_USER.p){
          stopCamera(); enterApp({u, name:'Administrator'}); toast('Login via QR sukses');
        } else {
          toast('QR login tidak valid');
        }
      } else if(/^https?:\/\//.test(s)){
        // If QR is a deep link with token, accept demo
        stopCamera(); enterApp({u:'qr', name:'QR User'}); toast('Login via URL');
      }
    }
  }, 250);
});

/********************
 * Boot
 ********************/
window.addEventListener('DOMContentLoaded', ()=>{
  const a = loadAuth(); if(a){ enterApp(a) }
});
</script>
</body>
</html>
